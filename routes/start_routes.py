from aiogram import Router
from aiogram.filters import Command
from aiogram.types import Message, FSInputFile

from services.image_map import generate_office_map
from ai.gpt_assistant import ask_gpt
from database.db import save_user  # ‚úÖ –∏–º–ø–æ—Ä—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

router = Router()


@router.message(Command("start"))
async def cmd_start(message: Message):
    # ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
    save_user(user_id=message.from_user.id, username=message.from_user.username)

    await message.answer(
        "–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π –ª–∏—á–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é –º–µ—Å—Ç –≤ –æ—Ñ–∏—Å–µ üß†\n"
        "–Ø –º–æ–≥—É –ø–æ–º–æ—á—å —Å —Ç–∞–∫–∏–º–∏ –≤–µ—â–∞–º–∏ –∫–∞–∫: \n"
        "- –ö—Ç–æ –±—É–¥–µ—Ç –≤ –æ—Ñ–∏—Å–µ\n"
        "- –ö–∞–∫–æ–π –¥–µ–Ω—å –≤—ã–±—Ä–∞—Ç—å\n"
        "- –í–æ–ø—Ä–æ—Å—ã –ø–æ –∫–æ–º–∞–Ω–¥–µ, –≤—Å—Ç—Ä–µ—á–∞–º –∏ —Ç.–¥.\n"
        "- –ü–æ–∫–∞–∂—É —Å—Ö–µ–º—É –º–µ—Å—Ç\n"
        "- –ó–∞–±—Ä–æ–Ω–∏—Ä—É—é –∏–ª–∏ –æ—Ç–º–µ–Ω—é –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ\n"
        
        "–í–æ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –º–µ—Å—Ç:"
    )
    image_path = generate_office_map()
    await message.answer_photo(FSInputFile(image_path))


@router.message(Command("aihelp"))
async def cmd_aihelp(message: Message):
    await message.answer(
        "üßæ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —á–∞—Ç-–±–æ—Ç–∞:\n\n"
        "üìå –ö–æ–º–∞–Ω–¥—ã:\n"
        "/start ‚Äî –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É –∏ –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ö–µ–º—É –æ—Ñ–∏—Å–∞\n"
        "/book A1 2025-08-01 ‚Äî –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –º–µ—Å—Ç–æ\n"
        "/cancel A1 2025-08-01 ‚Äî –æ—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω—å\n"
        "/mybookings ‚Äî —Å–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π\n"
        "/map ‚Äî —Å—Ö–µ–º–∞ –º–µ—Å—Ç –Ω–∞ —Å–µ–≥–æ–¥–Ω—è\n"
        "/ai [–≤–æ–ø—Ä–æ—Å] ‚Äî –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–º–æ—â—å –æ—Ç –ò–ò\n"
        "ü§ñ –Ø —Ç–∞–∫–∂–µ –ø–æ–Ω–∏–º–∞—é –æ–±—ã—á–Ω—ã–µ —Ñ—Ä–∞–∑—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä:\n"
        "‚Äî ¬´–∑–∞–±—Ä–æ–Ω–∏—Ä—É–π –º–µ—Å—Ç–æ B2 –∑–∞–≤—Ç—Ä–∞¬ª\n"
        "‚Äî ¬´–∫—Ç–æ –±—É–¥–µ—Ç –≤ –æ—Ñ–∏—Å–µ –≤ –ø—è—Ç–Ω–∏—Ü—É¬ª\n"
        "‚Äî ¬´–ø–æ–∫–∞–∂–∏ –∑–∞–Ω—è—Ç—ã–µ –º–µ—Å—Ç–∞ –Ω–∞ 2025-08-12¬ª"
    )